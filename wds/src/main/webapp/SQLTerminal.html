<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>WDS - SQL Terminal</title>
		<script type='text/javascript' src='http://fenixapps.fao.org/repository/js/jquery/1.8.1/jquery.min.js'></script>
		<script type='text/javascript' src='js/codemirror-utils.js'></script>
		<script type='text/javascript' src='http://fenixapps.fao.org/repository/js/codemirror/3.11/codemirror.js'></script>
		<script type='text/javascript' src='http://fenixapps.fao.org/repository/js/codemirror/3.11/sql/sql.js'></script>
		<script type='text/javascript' src='http://fenixapps.fao.org/repository/js/codemirror/3.11/sql/continuelist.js'></script>
		<script type='text/javascript' src='http://fenixapps.fao.org/repository/js/codemirror/3.11/selection/active-line.js'></script>
		<style type="text/css">
      		.CodeMirror {border-top: 1px solid black; border-bottom: 1px solid black; height: 250px !important;}
      		.CodeMirror-activeline-background {background: #e8f2ff !important;}
    	</style>
		<link rel='stylesheet' href='http://fenixapps.fao.org/repository/css/codemirror/3.11/codemirror.css'>
		<script type='text/javascript'>
			function query() {
				
				var script = CMU.getValue();
				script = script.replace(/\n/g, ' ');
				var db = $('#db').val();
				var sql = {};
				
				sql.limit = null;
				sql.query = script;
				sql.frequency = "NONE";
				
				var data = {};
				data.datasource = db;
				data.thousandSeparator = ',';
				data.decimalSeparator = '.';
				data.decimalNumbers = '2';
				data.json = JSON.stringify(sql);
				data.cssFilename = 'faostat';
				data.valueIndex = '1';
				
				$.ajax({
					
					type : 'POST',
					url : 'http://localhost:8080/wds/rest/table/json',
					data : data,
						
					success : function(response) {
						var s = '<table border="1" style="width: 100%; border-collapse: collapse;">';
						for (var i = 0 ; i < response.length ; i++) {
							s += '<tr>';
							for (var j = 0 ; j < response[i].length ; j++)
								s += '<td>' + response[i][j] + '</td>'
							s += '</tr>';
						}
						s += '</table>';
						document.getElementById('result').innerHTML = s;
					},
					
					error : function(err, b, c) {
							
					}
					
				});
				
			}
		</script>
	</head>
	
	<body onload='CMU.init("sql");'>
	
		<div align='center'>
			
			<div style='width: 1000px;'>
				
				<div align='center'>
					
					<table style='width: 928px;'>
					
						<tr>
							<td>
								<div>WDS - SQL Terminal</div>
							</td>
						</tr>
						
						<tr>
							<td>
								<textarea style='width: 99%;' rows='10' id='sql'></textarea>
							</td>
						</tr>
						
						<tr>
							<td>
								<select style='width: 100%;' id='db'>
									<option value='faostat'>FAOSTAT</option>
								</select>
							</td>
						</tr>
						
						<tr>
							<td>
								<input type='button' style='width: 100%;' value='Query DB' onclick='query();'/>
							</td>
						</tr>
						
						<tr>
							<td>
								&nbsp;
							</td>
						</tr>
						
						<tr>
							<td>
								<div id='result' style='height: 595px; overflow: auto;'></div>
							</td>
						</tr>
					
					</table>
					
				</div>
				
			</div>
			
		</div>
	
	</body>

</html>